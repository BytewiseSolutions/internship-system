import{a as de}from"./chunk-ZI2MEB23.js";import{C as le,D as ce,a as re,b as se,k as ae}from"./chunk-OSMB4DQJ.js";import{$ as A,A as M,B as b,Ba as ne,C as O,Ca as oe,D as y,E,H as k,I as F,J as V,L as D,N as L,V as N,W as U,X as $,_ as B,c as P,ca as W,d as R,da as j,ea as H,fa as z,g as _,ga as q,h,ha as Y,i as l,j as x,k as S,ka as G,l as m,m as d,ma as J,n as s,na as K,o as a,oa as Q,p as u,q as w,qa as X,r as g,s as p,ta as Z,u as I,ua as ee,v as c,va as te,w as f,y as T,ya as ie,z as C}from"./chunk-6NGTZMOM.js";import"./chunk-447CKG3T.js";import"./chunk-CDZFCBFW.js";import"./chunk-E2CLONXR.js";import"./chunk-KRDHHS7Z.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-LRFGNCHE.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";var pe=(()=>{let r=class r{constructor(t){this.http=t,this.apiUrl="http://localhost:8000"}addReview(t){return this.http.post(`${this.apiUrl}/reviews/add_review.php`,t)}getStudentReviews(t){return this.http.get(`${this.apiUrl}/reviews/get_student_reviews.php?user_id=${t}`)}getCompletedInternships(t){return this.http.get(`${this.apiUrl}/reviews/get_completed_internships.php?user_id=${t}`)}updateReview(t){return this.http.put(`${this.apiUrl}/reviews/update_review.php`,t)}};r.\u0275fac=function(e){return new(e||r)(R(L))},r.\u0275prov=P({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var _e=()=>[1,2,3,4,5];function he(o,r){o&1&&(s(0,"div",12)(1,"p"),c(2,"Loading reviews..."),a()())}function ve(o,r){o&1&&(s(0,"div",13)(1,"p"),c(2,"No reviews yet."),a(),s(3,"p"),c(4,"Share your internship experience!"),a()())}function ue(o,r){if(o&1&&u(0,"ion-icon",19),o&2){let i=r.$implicit,t=p().$implicit;I("filled",i<=t.rating),d("name",i<=t.rating?"star":"star-outline")}}function we(o,r){if(o&1){let i=w();s(0,"ion-card",14)(1,"ion-card-header")(2,"ion-card-title"),c(3),a()(),s(4,"ion-card-content")(5,"div",15),m(6,ue,1,3,"ion-icon",16),a(),s(7,"p"),c(8),a(),s(9,"div",17)(10,"small"),c(11),y(12,"date"),a(),s(13,"ion-button",18),g("click",function(){let e=_(i).$implicit,n=p();return h(n.editReview(e))}),c(14," Edit "),a()()()()}if(o&2){let i=r.$implicit;l(3),f(i.internship_title),l(3),d("ngForOf",O(6,_e)),l(2),f(i.review_text),l(3),f(E(12,4,i.created_at))}}function fe(o,r){if(o&1&&(s(0,"ion-select-option",35),c(1),a()),o&2){let i=r.$implicit;d("value",i.internship_id),l(),T(" ",i.internship_title," - ",i.company_name," ")}}function xe(o,r){if(o&1){let i=w();s(0,"ion-select",33),b("ngModelChange",function(e){_(i);let n=p(3);return M(n.selectedInternshipId,e)||(n.selectedInternshipId=e),h(e)}),m(1,fe,2,3,"ion-select-option",34),a()}if(o&2){let i=p(3);C("ngModel",i.selectedInternshipId),l(),d("ngForOf",i.completedInternships)}}function Ie(o,r){o&1&&(s(0,"p",36),c(1," No completed internships available for review. "),a())}function Ce(o,r){if(o&1&&(s(0,"ion-item"),m(1,xe,2,2,"ion-select",31)(2,Ie,2,0,"p",32),a()),o&2){let i=p(2);l(),d("ngIf",i.completedInternships.length>0),l(),d("ngIf",i.completedInternships.length===0)}}function Me(o,r){if(o&1){let i=w();s(0,"ion-icon",37),g("click",function(){let e=_(i).$implicit,n=p(2);return h(n.setRating(e))}),a()}if(o&2){let i=r.$implicit,t=p(2);I("filled",i<=t.rating),d("name",i<=t.rating?"star":"star-outline")}}function be(o,r){if(o&1){let i=w();s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),c(3),a(),s(4,"ion-buttons",20)(5,"ion-button",21),g("click",function(){_(i);let e=p();return h(e.closeModal())}),u(6,"ion-icon",22),a()()()(),s(7,"ion-content")(8,"div",23),m(9,Ce,3,2,"ion-item",24),s(10,"ion-item")(11,"ion-label",25),c(12,"Rating *"),a(),s(13,"div",26),m(14,Me,1,3,"ion-icon",27),a()(),s(15,"ion-item")(16,"ion-textarea",28),b("ngModelChange",function(e){_(i);let n=p();return M(n.reviewText,e)||(n.reviewText=e),h(e)}),a()(),s(17,"div",29)(18,"ion-button",7),g("click",function(){_(i);let e=p();return h(e.saveReview())}),c(19," Save Review "),a(),s(20,"ion-button",30),g("click",function(){_(i);let e=p();return h(e.closeModal())}),c(21," Cancel "),a()()()()}if(o&2){let i=p();l(3),f(i.isEditing?"Edit Review":"Add Review"),l(6),d("ngIf",!i.isEditing),l(5),d("ngForOf",i.getStarArray(5)),l(2),C("ngModel",i.reviewText)}}var Ve=(()=>{let r=class r{constructor(t,e){this.reviewService=t,this.authService=e,this.reviews=[],this.completedInternships=[],this.isLoading=!0,this.isModalOpen=!1,this.showToast=!1,this.toastMessage="",this.toastColor="success",this.selectedInternshipId=null,this.rating=5,this.reviewText="",this.editingReviewId=null,this.isEditing=!1,re({addOutline:se,starOutline:ce,closeOutline:ae,star:le})}ngOnInit(){this.loadReviews(),this.loadCompletedInternships()}loadReviews(){let e=this.authService.getCurrentUser()?.id;e?this.reviewService.getStudentReviews(e).subscribe({next:n=>{this.reviews=n.success?n.reviews:[],this.isLoading=!1},error:n=>{console.error("Error loading reviews:",n),this.reviews=[],this.isLoading=!1}}):this.isLoading=!1}loadCompletedInternships(){let e=this.authService.getCurrentUser()?.id;console.log("Loading completed internships for user ID:",e),e&&this.reviewService.getCompletedInternships(e).subscribe({next:n=>{this.completedInternships=n.success?n.internships:[]},error:n=>{console.error("Error loading completed internships:",n),this.completedInternships=[]}})}addReview(){if(this.completedInternships.length===0){this.showToastMessage("No completed internships available for review. You need to have accepted applications first.","warning");return}this.resetForm(),this.isEditing=!1,this.isModalOpen=!0}editReview(t){this.selectedInternshipId=t.internship_id,this.rating=t.rating,this.reviewText=t.review_text,this.editingReviewId=t.review_id,this.isEditing=!0,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.resetForm()}saveReview(){if(!this.isEditing&&!this.selectedInternshipId||!this.reviewText.trim()){this.showToastMessage("Please fill in all required fields","warning");return}if(this.isEditing){let t={review_id:this.editingReviewId,rating:this.rating,review_text:this.reviewText};this.reviewService.updateReview(t).subscribe({next:e=>{e.success?(this.showToastMessage("Review updated successfully!","success"),this.loadReviews(),this.closeModal()):this.showToastMessage(e.message||"Failed to update review","danger")},error:e=>{console.error("Error updating review:",e),this.showToastMessage("Network error. Please try again.","danger")}})}else{let e=this.authService.getCurrentUser()?.id;if(!e){this.showToastMessage("User ID not found","danger");return}let n={user_id:e,internship_id:this.selectedInternshipId,rating:this.rating,review_text:this.reviewText};this.reviewService.addReview(n).subscribe({next:v=>{v.success?(this.showToastMessage("Review added successfully!","success"),this.loadReviews(),this.closeModal()):this.showToastMessage(v.message||"Failed to save review","danger")},error:v=>{console.error("Error saving review:",v),this.showToastMessage("Network error. Please try again.","danger")}})}}getStarArray(t){return Array(5).fill(0).map((e,n)=>n+1)}setRating(t){this.rating=t}resetForm(){this.selectedInternshipId=null,this.rating=5,this.reviewText="",this.editingReviewId=null,this.isEditing=!1}showToastMessage(t,e){this.toastMessage=t,this.toastColor=e,this.showToast=!0}};r.\u0275fac=function(e){return new(e||r)(x(pe),x(de))},r.\u0275cmp=S({type:r,selectors:[["app-reviews"]],decls:18,vars:8,consts:[["color","primary"],["slot","start"],["defaultHref","/tabs/home"],[1,"reviews-content"],["class","loading-message",4,"ngIf"],["class","no-reviews",4,"ngIf"],[1,"add-section"],["expand","block","color","primary",3,"click"],["name","add-outline","slot","start"],["class","review-card",4,"ngFor","ngForOf"],[3,"didDismiss","isOpen"],[3,"didDismiss","isOpen","message","duration","color"],[1,"loading-message"],[1,"no-reviews"],[1,"review-card"],[1,"rating"],[3,"name","filled",4,"ngFor","ngForOf"],[1,"review-footer"],["fill","clear","size","small",3,"click"],[3,"name"],["slot","end"],[3,"click"],["name","close-outline"],[1,"modal-content"],[4,"ngIf"],["position","stacked"],[1,"rating-selector"],[3,"name","filled","click",4,"ngFor","ngForOf"],["label","Review *","label-placement","stacked","placeholder","Share your internship experience...","rows","4",3,"ngModelChange","ngModel"],[1,"modal-buttons"],["expand","block","fill","outline",3,"click"],["label","Select Internship *","label-placement","stacked","placeholder","Choose internship to review",3,"ngModel","ngModelChange",4,"ngIf"],["style","color: #666; font-style: italic; margin-top: 10px;",4,"ngIf"],["label","Select Internship *","label-placement","stacked","placeholder","Choose internship to review",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[2,"color","#666","font-style","italic","margin-top","10px"],[3,"click","name"]],template:function(e,n){e&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),u(3,"ion-back-button",2),a(),s(4,"ion-title"),c(5,"Reviews"),a()()(),s(6,"ion-content")(7,"div",3),m(8,he,3,0,"div",4)(9,ve,5,0,"div",5),s(10,"div",6)(11,"ion-button",7),g("click",function(){return n.addReview()}),u(12,"ion-icon",8),c(13," Add Review "),a()(),m(14,we,15,7,"ion-card",9),a(),s(15,"ion-modal",10),g("didDismiss",function(){return n.closeModal()}),m(16,be,22,4,"ng-template"),a(),s(17,"ion-toast",11),g("didDismiss",function(){return n.showToast=!1}),a()()),e&2&&(l(8),d("ngIf",n.isLoading),l(),d("ngIf",!n.isLoading&&n.reviews.length===0),l(5),d("ngForOf",n.reviews),l(),d("isOpen",n.isModalOpen),l(2),d("isOpen",n.showToast)("message",n.toastMessage)("duration",3e3)("color",n.toastColor))},dependencies:[D,k,F,$,N,U,J,te,Z,G,H,q,Y,z,W,ie,B,j,A,K,Q,ne,X,oe,ee,V],styles:[".reviews-content[_ngcontent-%COMP%]{padding:1rem}.loading-message[_ngcontent-%COMP%], .no-reviews[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#666}.add-section[_ngcontent-%COMP%]{margin-bottom:1rem}.add-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 12px;font-weight:600}.review-card[_ngcontent-%COMP%]{margin-bottom:1rem;border-radius:12px;box-shadow:0 2px 8px #0000001a}.review-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{color:#2e7d32;font-weight:600}.rating[_ngcontent-%COMP%]{margin-bottom:.5rem}.rating[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#ddd;margin-right:.25rem}.rating[_ngcontent-%COMP%]   ion-icon.filled[_ngcontent-%COMP%]{color:#ffc107}.modal-content[_ngcontent-%COMP%]{padding:1rem}.modal-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;margin-bottom:1rem}.rating-selector[_ngcontent-%COMP%]{display:flex;gap:.25rem;padding:.5rem 0}.rating-selector[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem;color:#ddd;cursor:pointer}.rating-selector[_ngcontent-%COMP%]   ion-icon.filled[_ngcontent-%COMP%]{color:#ffc107}.modal-buttons[_ngcontent-%COMP%]{padding:1rem 0;display:flex;flex-direction:column;gap:.5rem}.modal-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 12px;font-weight:600}"]});let o=r;return o})();export{Ve as ReviewsPage};
